<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Corporativo | Super Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark px-3">
        <span class="navbar-brand">üè¢ Super Admin Corp</span>
        <button class="btn btn-outline-light btn-sm" id="logoutBtn">Salir</button>
    </nav>

    <div class="container mt-4">
        <ul class="nav nav-tabs mb-4" id="adminTabs">
            <li class="nav-item"><a class="nav-link active" href="#companies" data-bs-toggle="tab">Empresas</a></li>
            <li class="nav-item"><a class="nav-link" href="#audit" data-bs-toggle="tab">Auditor√≠a Global</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="companies">
                <div class="card shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Empresas Registradas</h5>
                        <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#newCompanyModal">+ Nueva Empresa</button>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead><tr><th>ID</th><th>Nombre</th><th>Plan</th><th>Estado</th><th>Acciones</th></tr></thead>
                            <tbody id="companiesTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="audit">
                <div class="alert alert-info">Logs de seguridad global cargados desde Firestore.</div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="newCompanyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Registrar Empresa</h5></div>
                <div class="modal-body">
                    <form id="createCompanyForm">
                        <input type="text" class="form-control mb-2" id="compName" placeholder="Nombre Empresa" required>
                        <input type="text" class="form-control mb-2" id="compCode" placeholder="C√≥digo (ej: 192)" required>
                        <select class="form-select mb-2" id="compPlan">
                            <option value="Basic">B√°sico</option>
                            <option value="Pro">Pro</option>
                            <option value="Enterprise">Enterprise</option>
                        </select>
                        <button type="submit" class="btn btn-primary w-100">Crear</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { initAuthGuard, logoutUser } from './auth.js';
        import { createCompany, getCompanies } from './db.js';

        initAuthGuard('CORP'); // Protege la ruta

        document.getElementById('logoutBtn').onclick = logoutUser;

        // Cargar Empresas
        async function loadData() {
            const list = await getCompanies();
            const tbody = document.getElementById('companiesTable');
            tbody.innerHTML = list.map(c => `
                <tr>
                    <td>EMP-${c.code}</td>
                    <td>${c.name}</td>
                    <td><span class="badge bg-info">${c.plan}</span></td>
                    <td>${c.active ? 'üü¢ Activa' : 'üî¥ Inactiva'}</td>
                    <td><button class="btn btn-sm btn-outline-secondary">Editar</button></td>
                </tr>
            `).join('');
        }
        loadData();

        document.getElementById('createCompanyForm').onsubmit = async (e) => {
            e.preventDefault();
            await createCompany({
                name: document.getElementById('compName').value,
                code: document.getElementById('compCode').value,
                plan: document.getElementById('compPlan').value
            });
            location.reload();
        };
    </script>
</body>
</html>
