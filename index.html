<div class="modal fade" id="modalEmpresa" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Nueva Empresa</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <form id="formEmpresa">
                    <div class="mb-2">
                        <label class="small fw-bold">Nombre Comercial</label>
                        <input type="text" id="cName" class="form-control" placeholder="Ej: FCI Logistic" required>
                    </div>
                    <div class="mb-2">
                        <label class="small fw-bold">Email del Administrador</label>
                        <input type="email" id="cAdminEmail" class="form-control" placeholder="admin@cliente.com" required>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Contraseña de Acceso</label>
                        <input type="text" id="cPassword" class="form-control" placeholder="Mínimo 6 caracteres" required minlength="6">
                        <small class="text-muted">Anota esta contraseña para enviarla al cliente.</small>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Plan</label>
                        <select id="cPlan" class="form-select">
                            <option value="Básico">Básico ($29)</option>
                            <option value="Pro">Pro ($79)</option>
                            <option value="Enterprise">Enterprise (Custom)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Crear Empresa y Usuario</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { logout, authGuard } from './auth.js';
    // Importamos createCompany desde el db.js corregido
    import { createCompany, getCompanies, toggleCompanyStatus, getUsersByCompany, addPayment, getCompanyPayments, getCompanyStats, getSupplies, exportToXLS } from './db.js';

    authGuard('SUPER_ADMIN'); 
    document.getElementById('logoutBtn').onclick = logout;

    // ... (Mantén las funciones loadSidebar, selectCompany, etc. igual que antes) ...

    // ACTUALIZA ESTA PARTE (Evento de crear empresa):
    document.getElementById('formEmpresa').onsubmit = async (e) => {
        e.preventDefault();
        
        const btn = e.target.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = "Creando...";
        btn.disabled = true;

        try {
            await createCompany({
                name: document.getElementById('cName').value,
                adminEmail: document.getElementById('cAdminEmail').value,
                password: document.getElementById('cPassword').value, // Nuevo campo
                plan: document.getElementById('cPlan').value
            });
            alert("Empresa y Usuario Admin creados exitosamente.");
            bootstrap.Modal.getInstance(document.getElementById('modalEmpresa')).hide();
            e.target.reset();
            loadSidebar(); // Recargar lista
        } catch (error) {
            alert("Error: " + error.message);
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    };

    // ... (Resto del script igual) ...
</script>
